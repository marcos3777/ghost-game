import{S as L,C as z,O as I,W as C,L as B,a as G,b as W,M as w,D as x,P as E,c as d,B as R,V as T,d as A,G as k,e as P,f as g,g as O,h as H,i as D,A as F,j as q}from"./three-wPfRQVUL.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=e(s);fetch(s.href,n)}})();class V{constructor(){this.scene=new L,this.scene.background=new z(0);const t=window.innerWidth/window.innerHeight,e=20;this.camera=new I(e*t/-2,e*t/2,e/2,e/-2,.1,1e3),this.camera.position.set(0,10,0),this.camera.lookAt(0,0,0),this.camera.rotation.z=0,this.renderer=new C({antialias:!0}),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.shadowMap.enabled=!1,document.getElementById("game-container").appendChild(this.renderer.domElement),this.cameraTarget=null,this.frustumSize=e}handleResize(){const t=window.innerWidth/window.innerHeight;this.camera.left=this.frustumSize*t/-2,this.camera.right=this.frustumSize*t/2,this.camera.top=this.frustumSize/2,this.camera.bottom=this.frustumSize/-2,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)}setCameraTarget(t){this.cameraTarget=t,this.camera.position.set(t.position.x,10,t.position.z)}updateCamera(){this.cameraTarget&&(this.camera.position.x=this.cameraTarget.position.x,this.camera.position.z=this.cameraTarget.position.z)}clearScene(){const t=[];this.scene.traverse(e=>{e instanceof B||e instanceof G||e!==this.scene&&t.push(e)}),t.forEach(e=>{this.scene.remove(e)})}render(){this.updateCamera(),this.renderer.render(this.scene,this.camera)}}class K{constructor(){this.wallMaterial=new W({color:10066329,linewidth:2}),this.pathMaterial=new w({color:0,side:x}),this.walls=[],this.startPosition={x:0,z:0},this.endPosition={x:0,z:0},this.cellSize=1,this.wallThickness=.1}generate(t,e){const i=Array(e).fill().map(()=>Array(t).fill(0)),s=Array(e).fill().map(()=>Array(t).fill().map(()=>({top:0,right:0,bottom:0,left:0}))),n=0,o=0;i[o][n]=1,this.startPosition={x:n*this.cellSize-t*this.cellSize/2+this.cellSize/2,z:o*this.cellSize-e*this.cellSize/2+this.cellSize/2},this.recursiveBacktracking(i,s,n,o,t,e);const a=t-1,r=e-1;return this.ensurePathToEnd(i,s,a,r,t,e),this.endPosition={x:a*this.cellSize-t*this.cellSize/2+this.cellSize/2,z:r*this.cellSize-e*this.cellSize/2+this.cellSize/2},{grid:i,walls:s}}ensurePathToEnd(t,e,i,s,n,o){if(t[s][i]=1,i>0&&t[s][i-1]===1)e[s][i].left=1,e[s][i-1].right=1;else if(s>0&&t[s-1][i]===1)e[s][i].top=1,e[s-1][i].bottom=1;else if(i<n-1&&t[s][i+1]===1)e[s][i].right=1,e[s][i+1].left=1;else if(s<o-1&&t[s+1][i]===1)e[s][i].bottom=1,e[s+1][i].top=1;else{let a=!1;for(let r=1;r<n+o&&!a;r++)for(let h=-r;h<=r&&!a;h++)for(let l=-r;l<=r&&!a;l++){if(Math.abs(h)!==r&&Math.abs(l)!==r)continue;const f=i+h,c=s+l;f>=0&&f<n&&c>=0&&c<o&&t[c][f]===1&&(this.connectCells(t,e,i,s,f,c,n,o),a=!0)}}}connectCells(t,e,i,s,n,o,a,r){const h=Array(r).fill().map(()=>Array(a).fill(!1)),l=[{x:i,y:s,path:[]}];for(h[s][i]=!0;l.length>0;){const{x:f,y:c,path:p}=l.shift();if(f===n&&c===o){let u=i,m=s;for(const y of p)y==="top"?(e[m][u].top=1,e[m-1][u].bottom=1,m--):y==="right"?(e[m][u].right=1,e[m][u+1].left=1,u++):y==="bottom"?(e[m][u].bottom=1,e[m+1][u].top=1,m++):y==="left"&&(e[m][u].left=1,e[m][u-1].right=1,u--);return}const b=[{dx:0,dy:-1,dir:"top"},{dx:1,dy:0,dir:"right"},{dx:0,dy:1,dir:"bottom"},{dx:-1,dy:0,dir:"left"}];for(const{dx:u,dy:m,dir:y}of b){const M=f+u,S=c+m;M>=0&&M<a&&S>=0&&S<r&&!h[S][M]&&(h[S][M]=!0,l.push({x:M,y:S,path:[...p,y]}))}}}recursiveBacktracking(t,e,i,s,n,o){const a=[{dx:0,dy:-1,fromWall:"top",toWall:"bottom"},{dx:1,dy:0,fromWall:"right",toWall:"left"},{dx:0,dy:1,fromWall:"bottom",toWall:"top"},{dx:-1,dy:0,fromWall:"left",toWall:"right"}];this.shuffleArray(a);for(const{dx:r,dy:h,fromWall:l,toWall:f}of a){const c=i+r,p=s+h;c>=0&&c<n&&p>=0&&p<o&&t[p][c]===0&&(t[p][c]=1,e[s][i][l]=1,e[p][c][f]=1,this.recursiveBacktracking(t,e,c,p,n,o))}}buildMaze(t,e){const{grid:i,walls:s}=e,n=i.length,o=i[0].length;this.walls=[];const a=o*this.cellSize,r=n*this.cellSize,h=-a/2,l=-r/2,f=new E(a+1,r+1),c=new d(f,this.pathMaterial);c.rotation.x=-Math.PI/2,c.position.set(0,-.01,0),t.add(c),this.drawOuterWalls(t,o,n,h,l);for(let p=0;p<n;p++)for(let b=0;b<o;b++){const u=s[p][b],m=h+b*this.cellSize,y=l+p*this.cellSize;u.top===0&&this.drawWall(t,m,y,m+this.cellSize,y),u.right===0&&this.drawWall(t,m+this.cellSize,y,m+this.cellSize,y+this.cellSize),u.bottom===0&&this.drawWall(t,m,y+this.cellSize,m+this.cellSize,y+this.cellSize),u.left===0&&this.drawWall(t,m,y,m,y+this.cellSize)}}drawWall(t,e,i,s,n){const o=[new T(e,0,i),new T(s,0,n)],a=new R().setFromPoints(o),r=new A(a,this.wallMaterial);t.add(r);const h=(e+s)/2,l=(i+n)/2,f=Math.sqrt(Math.pow(s-e,2)+Math.pow(n-i,2)),c=Math.atan2(n-i,s-e);this.walls.push({x:h,z:l,length:f,angle:c,x1:e,z1:i,x2:s,z2:n,isHorizontal:Math.abs(i-n)<.1,isVertical:Math.abs(e-s)<.1})}drawOuterWalls(t,e,i,s,n){const o=e*this.cellSize,a=i*this.cellSize;this.drawWall(t,s,n,s+o,n),this.drawWall(t,s+o,n,s+o,n+a),this.drawWall(t,s,n+a,s+o,n+a),this.drawWall(t,s,n,s,n+a)}getStartPosition(){return this.startPosition}getEndPosition(){return this.endPosition}getWalls(){return this.walls}shuffleArray(t){for(let e=t.length-1;e>0;e--){const i=Math.floor(Math.random()*(e+1));[t[e],t[i]]=[t[i],t[e]]}}}class N{constructor(t){this.createGhostMesh(),this.floatSpeed=2.2,this.floatHeight=.1,this.floatTime=0,this.eyeSpeed=3,this.eyeTime=0}createGhostMesh(){this.mesh=new k,this.createPacManGhostBody(),this.createPacManGhostEyes();const t=new P(16777215,.5,3);t.position.set(0,.2,0),this.mesh.add(t),this.mesh.position.set(0,.1,0)}createPacManGhostBody(){const i=new g(.4,32,0,Math.PI),s=new w({color:16777215,side:x});this.bodyTop=new d(i,s),this.bodyTop.rotation.x=-Math.PI/2,this.bodyTop.position.y=.05,this.bodyTop.position.z=-.4/2,this.mesh.add(this.bodyTop);const n=new E(.4*2,.4);this.bodyBottom=new d(n,s),this.bodyBottom.rotation.x=-Math.PI/2,this.bodyBottom.position.y=.05,this.bodyBottom.position.z=0,this.mesh.add(this.bodyBottom);const o=.4*2/3,a=.4*.4;for(let r=0;r<3;r++){const h=new O,l=-.4+r*o;h.moveTo(l,0),h.lineTo(l+o,0),h.lineTo(l+o/2,a),h.lineTo(l,0);const f=new H(h),c=new d(f,s);c.rotation.x=-Math.PI/2,c.position.y=.05,c.position.z=.4/2,this.mesh.add(c)}}createPacManGhostEyes(){const t=new w({color:136}),e=new w({color:16777215}),i=new g(.12,24);this.leftEye=new d(i,t),this.leftEye.rotation.x=-Math.PI/2,this.leftEye.position.set(-.15,.07,-.1),this.mesh.add(this.leftEye);const s=new g(.12,24);this.rightEye=new d(s,t),this.rightEye.rotation.x=-Math.PI/2,this.rightEye.position.set(.15,.07,-.1),this.mesh.add(this.rightEye);const n=new g(.05,16);this.leftPupil=new d(n,e),this.leftPupil.rotation.x=-Math.PI/2,this.leftPupil.position.set(-.15,.08,-.07),this.mesh.add(this.leftPupil);const o=new g(.05,16);this.rightPupil=new d(o,e),this.rightPupil.rotation.x=-Math.PI/2,this.rightPupil.position.set(.15,.08,-.07),this.mesh.add(this.rightPupil)}setPosition(t,e,i){this.mesh.position.set(t,.1,i)}move(t,e){if(this.mesh.position.x+=t,this.mesh.position.z+=e,Math.abs(t)>.001||Math.abs(e)>.001){let o=Math.atan2(e,t)+Math.PI-this.mesh.rotation.y;for(;o>Math.PI;)o-=Math.PI*2;for(;o<-Math.PI;)o+=Math.PI*2;this.mesh.rotation.y+=o*.1}}update(t){this.floatTime+=t*this.floatSpeed;const e=Math.sin(this.floatTime)*this.floatHeight;if(this.mesh.position.y=.1+e,this.eyeTime+=t*this.eyeSpeed,this.leftPupil&&this.rightPupil){const n=Math.sin(this.eyeTime*.5)*.03,o=Math.cos(this.eyeTime*.5)*.03;this.leftPupil.position.x=-.15+n,this.leftPupil.position.z=-.07+o,this.rightPupil.position.x=.15+n,this.rightPupil.position.z=-.07+o}const i=1+.1*Math.sin(this.floatTime*1.5);this.bodyTop&&this.bodyBottom&&(this.bodyTop.scale.set(i,1,2-i),this.bodyBottom.scale.set(i,1,1))}}class U{constructor(t){this.createGameGirlMesh(),this.isWaving=!1,this.waveSpeed=3,this.waveTime=0,this.hairSpeed=1.2,this.hairTime=0}createGameGirlMesh(){this.mesh=new k;const t=16764074,e=16763904,i=16737996,s=new g(.3,32),n=new w({color:t});this.body=new d(s,n),this.body.rotation.x=-Math.PI/2,this.body.position.y=.05,this.mesh.add(this.body),this.createHair(e),this.createDress(i),this.createFace(t),this.createArms(t);const o=new P(16777130,.6,3);o.position.set(0,.3,0),this.mesh.add(o),this.mesh.position.set(0,.1,0)}createHair(t){const e=new w({color:t,side:x}),i=new g(.4,32);this.hairBack=new d(i,e),this.hairBack.rotation.x=-Math.PI/2,this.hairBack.position.set(0,.045,.05),this.mesh.add(this.hairBack);const s=new E(.35,.15);this.bangs=new d(s,e),this.bangs.rotation.x=-Math.PI/2,this.bangs.position.set(0,.051,-.2),this.mesh.add(this.bangs);const n=new E(.15,.3);this.leftHair=new d(n,e),this.leftHair.rotation.x=-Math.PI/2,this.leftHair.position.set(-.25,.048,0),this.mesh.add(this.leftHair);const o=new E(.15,.3);this.rightHair=new d(o,e),this.rightHair.rotation.x=-Math.PI/2,this.rightHair.position.set(.25,.048,0),this.mesh.add(this.rightHair)}createDress(t){const e=new w({color:t,side:x}),i=new g(.5,32);this.dress=new d(i,e),this.dress.rotation.x=-Math.PI/2,this.dress.position.set(0,.04,.1),this.mesh.add(this.dress)}createFace(t){const e=new w({color:3368652}),i=new g(.04,16);this.leftEye=new d(i,e),this.leftEye.rotation.x=-Math.PI/2,this.leftEye.position.set(-.08,.06,-.12),this.mesh.add(this.leftEye);const s=new g(.04,16);this.rightEye=new d(s,e),this.rightEye.rotation.x=-Math.PI/2,this.rightEye.position.set(.08,.06,-.12),this.mesh.add(this.rightEye);const n=new E(.12,.03),o=new w({color:16724838});this.mouth=new d(n,o),this.mouth.rotation.x=-Math.PI/2,this.mouth.position.set(0,.06,-.05),this.mesh.add(this.mouth);const a=new w({color:16751001}),r=new g(.05,16);this.leftBlush=new d(r,a),this.leftBlush.rotation.x=-Math.PI/2,this.leftBlush.position.set(-.15,.055,-.08),this.mesh.add(this.leftBlush);const h=new g(.05,16);this.rightBlush=new d(h,a),this.rightBlush.rotation.x=-Math.PI/2,this.rightBlush.position.set(.15,.055,-.08),this.mesh.add(this.rightBlush)}createArms(t){const e=new w({color:t,side:x}),i=new E(.1,.3);this.arm=new d(i,e),this.arm.rotation.x=-Math.PI/2,this.armPivot=new D,this.armPivot.position.set(.25,.06,0),this.mesh.add(this.armPivot),this.arm.position.set(.15,0,0),this.armPivot.add(this.arm)}setPosition(t,e,i){this.mesh.position.set(t,.1,i)}startBeckoning(){this.isWaving=!0}stopBeckoning(){this.isWaving=!1}update(t){if(this.isWaving&&this.armPivot){this.waveTime+=t*this.waveSpeed;const e=Math.sin(this.waveTime)*.8;this.armPivot.rotation.z=e}else this.armPivot&&(this.armPivot.rotation.z*=.9);if(this.hairTime+=t*this.hairSpeed,this.leftHair&&this.rightHair){const e=Math.sin(this.hairTime)*.05;this.leftHair.position.x=-.25+e,this.rightHair.position.x=.25-e}if(this.dress){const e=1+.03*Math.sin(this.hairTime*.8);this.dress.scale.set(e,1,e)}this.leftEye&&this.rightEye&&(Math.sin(this.hairTime*.5)>.95?(this.leftEye.scale.set(1,1,.1),this.rightEye.scale.set(1,1,.1)):(this.leftEye.scale.set(1,1,1),this.rightEye.scale.set(1,1,1)))}}class ${constructor(){this.keys={forward:!1,backward:!1,left:!1,right:!1},this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),this.onTouchStart=this.onTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp),this.setupTouchControls()}setupTouchControls(){this.upButton=document.getElementById("up-button"),this.downButton=document.getElementById("down-button"),this.leftButton=document.getElementById("left-button"),this.rightButton=document.getElementById("right-button"),this.upButton&&this.downButton&&this.leftButton&&this.rightButton&&(this.upButton.addEventListener("touchstart",()=>this.onTouchStart("up"),{passive:!0}),this.upButton.addEventListener("touchend",()=>this.onTouchEnd("up"),{passive:!0}),this.downButton.addEventListener("touchstart",()=>this.onTouchStart("down"),{passive:!0}),this.downButton.addEventListener("touchend",()=>this.onTouchEnd("down"),{passive:!0}),this.leftButton.addEventListener("touchstart",()=>this.onTouchStart("left"),{passive:!0}),this.leftButton.addEventListener("touchend",()=>this.onTouchEnd("left"),{passive:!0}),this.rightButton.addEventListener("touchstart",()=>this.onTouchStart("right"),{passive:!0}),this.rightButton.addEventListener("touchend",()=>this.onTouchEnd("right"),{passive:!0}))}onTouchStart(t){switch(t){case"up":this.keys.forward=!0;break;case"down":this.keys.backward=!0;break;case"left":this.keys.left=!0;break;case"right":this.keys.right=!0;break}}onTouchEnd(t){switch(t){case"up":this.keys.forward=!1;break;case"down":this.keys.backward=!1;break;case"left":this.keys.left=!1;break;case"right":this.keys.right=!1;break}}onKeyDown(t){switch(t.key){case"w":case"W":this.keys.forward=!0;break;case"s":case"S":this.keys.backward=!0;break;case"a":case"A":this.keys.left=!0;break;case"d":case"D":this.keys.right=!0;break;case"ArrowUp":this.keys.forward=!0;break;case"ArrowDown":this.keys.backward=!0;break;case"ArrowLeft":this.keys.left=!0;break;case"ArrowRight":this.keys.right=!0;break}}onKeyUp(t){switch(t.key){case"w":case"W":this.keys.forward=!1;break;case"s":case"S":this.keys.backward=!1;break;case"a":case"A":this.keys.left=!1;break;case"d":case"D":this.keys.right=!1;break;case"ArrowUp":this.keys.forward=!1;break;case"ArrowDown":this.keys.backward=!1;break;case"ArrowLeft":this.keys.left=!1;break;case"ArrowRight":this.keys.right=!1;break}}getMovement(){const t={x:0,z:0};if(this.keys.forward&&(t.z=-1),this.keys.backward&&(t.z=1),this.keys.left&&(t.x=-1),this.keys.right&&(t.x=1),t.x!==0&&t.z!==0){const e=Math.sqrt(t.x*t.x+t.z*t.z);t.x/=e,t.z/=e}return t}dispose(){window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp),this.upButton&&this.downButton&&this.leftButton&&this.rightButton&&(this.upButton.removeEventListener("touchstart",()=>this.onTouchStart("up")),this.upButton.removeEventListener("touchend",()=>this.onTouchEnd("up")),this.downButton.removeEventListener("touchstart",()=>this.onTouchStart("down")),this.downButton.removeEventListener("touchend",()=>this.onTouchEnd("down")),this.leftButton.removeEventListener("touchstart",()=>this.onTouchStart("left")),this.leftButton.removeEventListener("touchend",()=>this.onTouchEnd("left")),this.rightButton.removeEventListener("touchstart",()=>this.onTouchStart("right")),this.rightButton.removeEventListener("touchend",()=>this.onTouchEnd("right")))}}class Z{constructor(t){this.scene=t}setupLights(){this.clearLights();const t=new F(16777215,1);this.scene.add(t);const e=new q(16777215,.5);e.position.set(0,10,0),e.lookAt(0,0,0),this.scene.add(e)}clearLights(){const t=[];this.scene.traverse(e=>{e instanceof B&&!(e.parent instanceof k)&&t.push(e)}),t.forEach(e=>{this.scene.remove(e)})}update(t){}}class j{constructor(){this.timerElement=document.getElementById("timer"),this.scoreElement=document.getElementById("score"),this.levelElement=document.getElementById("level"),this.finalScoreElement=document.getElementById("final-score"),this.nextLevelElement=document.getElementById("next-level"),this.gameOverScreen=document.getElementById("game-over"),this.levelCompleteScreen=document.getElementById("level-complete"),this.loadingScreen=document.getElementById("loading"),this.instructionsElement=document.getElementById("instructions")}updateTimer(t){if(!this.timerElement)return;const e=Math.max(0,Math.floor(t));this.timerElement.textContent=`Time: ${e}`,e<=10?(this.timerElement.style.color="#ff3333",this.timerElement.style.fontWeight="bold",e<=5?this.timerElement.style.animation="pulse 0.5s infinite":this.timerElement.style.animation=""):(this.timerElement.style.color="",this.timerElement.style.fontWeight="",this.timerElement.style.animation="")}updateScore(t){if(!this.scoreElement)return;const e=Math.floor(t);this.scoreElement.textContent=`Score: ${e}`,this.finalScoreElement&&(this.finalScoreElement.textContent=e)}updateLevel(t){this.levelElement&&(this.levelElement.textContent=`Level: ${t}`,this.nextLevelElement&&(this.nextLevelElement.textContent=t+1))}showGameOver(){this.gameOverScreen&&(this.gameOverScreen.style.display="block")}hideGameOver(){this.gameOverScreen&&(this.gameOverScreen.style.display="none")}showLevelComplete(){this.levelCompleteScreen&&(this.levelCompleteScreen.style.display="block")}hideLevelComplete(){this.levelCompleteScreen&&(this.levelCompleteScreen.style.display="none")}showLoading(){this.loadingScreen&&(this.loadingScreen.style.display="block")}hideLoading(){this.loadingScreen&&(this.loadingScreen.style.display="none")}showInstructions(){this.instructionsElement&&(this.instructionsElement.style.display="block")}hideInstructions(){this.instructionsElement&&(this.instructionsElement.style.display="none")}screenShake(){document.body.classList.add("screen-shake"),setTimeout(()=>{document.body.classList.remove("screen-shake")},500)}flashScreen(){document.body.classList.add("screen-flash"),setTimeout(()=>{document.body.classList.remove("screen-flash")},300)}}class J{constructor(){this.ghostRadius=.3}checkCollision(t,e,i=0){const s=this.ghostRadius-i;for(const n of e)if(this.distanceToLineSegment(t.x,t.z,n.x1,n.z1,n.x2,n.z2)<s)return!0;return!1}distanceToLineSegment(t,e,i,s,n,o){const a=(n-i)*(n-i)+(o-s)*(o-s);if(a===0)return Math.sqrt((t-i)*(t-i)+(e-s)*(e-s));const r=Math.max(0,Math.min(1,((t-i)*(n-i)+(e-s)*(o-s))/a)),h=i+r*(n-i),l=s+r*(o-s);return Math.sqrt((t-h)*(t-h)+(e-l)*(e-l))}getSafePosition(t,e,i,s=0){if(!this.checkCollision(e,i,s))return e;const n={x:e.x,z:t.z},o={x:t.x,z:e.z};return this.checkCollision(n,i,s)?this.checkCollision(o,i,s)?t:o:n}findNearestWall(t,e){let i=null,s=1/0;for(const n of e){const o=this.distanceToLineSegment(t.x,t.z,n.x1,n.z1,n.x2,n.z2);o<s&&(s=o,i=n)}return{wall:i,distance:s}}}class Q{constructor(){this.audioContext=null,this.sounds={},this.music=null,this.ambientSound=null,this.masterVolume=.4,this.musicVolume=.3,this.sfxVolume=.5,this.initialized=!1}init(){if(!this.initialized)try{this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.loadSounds(),this.initialized=!0}catch(t){console.error("Audio initialization failed:",t)}}loadSounds(){const t=e=>({play:()=>{if(!this.audioContext)return;const i=this.audioContext.createOscillator();i.type=e.type||"sine",i.frequency.setValueAtTime(e.frequency,this.audioContext.currentTime);const s=this.audioContext.createGain();s.gain.setValueAtTime(0,this.audioContext.currentTime),s.gain.linearRampToValueAtTime(e.volume*this.sfxVolume*this.masterVolume,this.audioContext.currentTime+.01),s.gain.linearRampToValueAtTime(0,this.audioContext.currentTime+e.duration),i.connect(s),s.connect(this.audioContext.destination),i.start(),i.stop(this.audioContext.currentTime+e.duration)}});this.sounds={ghostMove:t({frequency:200,type:"sine",volume:.1,duration:.2}),wallCollision:t({frequency:100,type:"sawtooth",volume:.2,duration:.3}),levelComplete:t({frequency:440,type:"square",volume:.2,duration:.8}),gameOver:t({frequency:150,type:"sawtooth",volume:.3,duration:1.5}),womanBeckoning:t({frequency:600,type:"sine",volume:.15,duration:.5})}}playSound(t){this.initialized||this.init(),this.sounds[t]&&this.sounds[t].play()}playGhostMove(){this.playSound("ghostMove")}playWallCollision(){this.playSound("wallCollision")}playLevelComplete(){this.playSound("levelComplete")}playGameOver(){this.playSound("gameOver")}playWomanBeckoning(){this.playSound("womanBeckoning")}setMasterVolume(t){this.masterVolume=Math.max(0,Math.min(1,t))}setMusicVolume(t){this.musicVolume=Math.max(0,Math.min(1,t)),this.music&&(this.music.volume=this.musicVolume*this.masterVolume)}setSfxVolume(t){this.sfxVolume=Math.max(0,Math.min(1,t))}}class _{constructor(){document.title="2D Ghost Maze Game";const t=document.createElement("div");t.id="game-title",t.innerText="2D Ghost Maze",t.style.position="absolute",t.style.top="10px",t.style.left="50%",t.style.transform="translateX(-50%)",t.style.fontSize="24px",t.style.fontWeight="bold",t.style.color="#cccccc",t.style.zIndex="100",t.style.textShadow="2px 2px 4px rgba(0,0,0,0.8)",document.getElementById("game-container").appendChild(t),this.isRunning=!1,this.level=1,this.score=0,this.timeRemaining=60,this.baseTime=60,this.timePenaltyPerLevel=5,this.renderer=new V,this.mazeGenerator=new K,this.ghost=new N(this.renderer.scene),this.woman=new U(this.renderer.scene),this.inputHandler=new $,this.lightingManager=new Z(this.renderer.scene),this.uiManager=new j,this.collisionDetector=new J,this.audioManager=new Q,this.movementSpeed=3.5,this.collisionPadding=.1,this.animationFrameId=null,this.timerInterval=null,this.isGameOver=!1,this.isLevelComplete=!1,this.isRestarting=!1,this.setupEventListeners()}setupEventListeners(){this.update=this.update.bind(this),this.startGame=this.startGame.bind(this),this.gameOver=this.gameOver.bind(this),this.levelComplete=this.levelComplete.bind(this),this.restartGame=this.restartGame.bind(this),this.continueToNextLevel=this.continueToNextLevel.bind(this);const t=document.getElementById("restart-button"),e=document.getElementById("continue-button");t&&(t.removeEventListener("click",this.restartGame),t.addEventListener("click",i=>{i.preventDefault(),i.stopPropagation(),this.isRestarting||(this.isRestarting=!0,this.restartGame())})),e&&(e.removeEventListener("click",this.continueToNextLevel),e.addEventListener("click",i=>{i.preventDefault(),i.stopPropagation(),this.continueToNextLevel()})),window.addEventListener("load",()=>{document.getElementById("loading").style.display="none",this.startGame()}),window.addEventListener("resize",()=>{this.renderer.handleResize()})}startGame(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.timerInterval&&(clearInterval(this.timerInterval),this.timerInterval=null),this.isRunning=!0,this.isGameOver=!1,this.isLevelComplete=!1,this.isRestarting=!1,this.level=1,this.score=0,this.timeRemaining=this.baseTime;try{this.generateLevel(),this.lastTime=performance.now(),this.animationFrameId=requestAnimationFrame(this.update),this.timerInterval=setInterval(()=>{this.isRunning&&(this.timeRemaining--,this.uiManager.updateTimer(this.timeRemaining),this.timeRemaining<=0&&this.gameOver())},1e3)}catch(t){console.error("Failed to start game:",t),setTimeout(()=>{this.restartGame()},1e3)}}generateLevel(){const e=Math.min(10+Math.floor(this.level/2),20),i=this.mazeGenerator.generate(e,e);this.renderer.clearScene(),this.mazeGenerator.buildMaze(this.renderer.scene,i);const s=this.mazeGenerator.getStartPosition();this.ghost.setPosition(s.x,.1,s.z),this.renderer.scene.add(this.ghost.mesh);const n=this.mazeGenerator.getEndPosition();this.woman.setPosition(n.x,.1,n.z),this.renderer.scene.add(this.woman.mesh),this.lightingManager.setupLights(),this.uiManager.updateLevel(this.level),this.uiManager.updateScore(this.score),this.uiManager.updateTimer(this.timeRemaining),this.renderer.setCameraTarget(this.ghost.mesh)}update(t){if(this.renderer.render(),!this.isRunning){this.animationFrameId=requestAnimationFrame(this.update);return}const e=Math.min((t-this.lastTime)/1e3,.1);this.lastTime=t;const i=this.inputHandler.getMovement();if(i.x!==0||i.z!==0){const n=this.ghost.mesh.position.x+i.x*e*this.movementSpeed,o=this.ghost.mesh.position.z+i.z*e*this.movementSpeed,a={x:n,z:this.ghost.mesh.position.z},r={x:this.ghost.mesh.position.x,z:o},h=this.collisionDetector.checkCollision(a,this.mazeGenerator.getWalls(),this.collisionPadding),l=this.collisionDetector.checkCollision(r,this.mazeGenerator.getWalls(),this.collisionPadding);h||(this.ghost.mesh.position.x=n),l||(this.ghost.mesh.position.z=o),this.renderer.setCameraTarget(this.ghost.mesh)}this.ghost.update(e);const s=this.ghost.mesh.position.distanceTo(this.woman.mesh.position);if(s<1.5?this.woman.startBeckoning():this.woman.stopBeckoning(),this.woman.update(e),s<.7&&!this.isLevelComplete){this.levelComplete();return}this.animationFrameId=requestAnimationFrame(this.update)}levelComplete(){this.isLevelComplete||(this.isRunning=!1,this.isLevelComplete=!0,this.score+=this.level*100+this.timeRemaining*10,this.uiManager.updateScore(this.score),document.getElementById("next-level").textContent=this.level+1,document.getElementById("level-complete").style.display="block",this.audioManager.playLevelComplete())}continueToNextLevel(){if(this.isLevelComplete){document.getElementById("level-complete").style.display="none",this.level++,this.timeRemaining=Math.max(30,this.baseTime-(this.level-1)*this.timePenaltyPerLevel);try{this.isLevelComplete=!1,this.generateLevel(),this.isRunning=!0,this.lastTime=performance.now(),this.animationFrameId&&cancelAnimationFrame(this.animationFrameId),this.animationFrameId=requestAnimationFrame(this.update)}catch(t){console.error("Error generating next level:",t),this.restartGame()}}}gameOver(){this.isGameOver||(this.isRunning=!1,this.isGameOver=!0,this.timerInterval&&(clearInterval(this.timerInterval),this.timerInterval=null),document.getElementById("final-score").textContent=this.score,document.getElementById("game-over").style.display="block",this.audioManager.playGameOver())}restartGame(){this.isRestarting&&(this.isRestarting=!1,document.getElementById("game-over").style.display="none",document.getElementById("level-complete").style.display="none",this.timerInterval&&(clearInterval(this.timerInterval),this.timerInterval=null),this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.renderer.clearScene(),setTimeout(()=>{this.startGame()},100))}}document.addEventListener("DOMContentLoaded",()=>{new _});
